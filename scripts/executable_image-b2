#!/usr/bin/env python
import requests
import string
import random
import os
from argparse import ArgumentParser
from datetime import datetime, timedelta

import pyperclip
from b2sdk import v2 as b2

parser = ArgumentParser()
parser.add_argument("image", help="path to image to upload")
parser.add_argument(
    "-t", "--timebomb", help="Delete after 24 hours", action="store_true"
)
parser.add_argument("-e", "--emojis", help="Use emojis instead ", action="store_true")
parser.add_argument(
    "--no-copy", help="do not copy the link", action="store_true", required=False
)
args = parser.parse_args()


if (not os.path.exists(args.image)) or (not os.path.isfile(args.image)):
    raise OSError("image not provided or unknown file type")


now = datetime.now()


info = b2.InMemoryAccountInfo()
b2_api = b2.B2Api(info)
b2_api.authorize_account(
    realm="production", application_key_id=os.getenv("B2_APPLICATION_KEY_ID"), application_key=os.getenv("B2_APPLICATION_KEY")
)
bucket = b2_api.get_bucket_by_name("botato-img-host")



adjectives = requests.get(
    "https://github.com/ShareX/ShareX/raw/develop/ShareX.HelpersLib/Resources/adjectives.txt"
).text.split("\n")

animals = requests.get(
    "https://github.com/ShareX/ShareX/raw/develop/ShareX.HelpersLib/Resources/animals.txt"
).text.split("\n")

if args.emojis:
    emojis = [
        "ğŸ˜€",
        "ğŸ˜",
        "ğŸ˜‚",
        "ğŸ¤£",
        "ğŸ˜ƒ",
        "ğŸ˜„",
        "ğŸ˜…",
        "ğŸ˜†",
        "ğŸ˜‰",
        "ğŸ˜Š",
        "ğŸ˜‹",
        "ğŸ˜",
        "ğŸ˜",
        "ğŸ˜˜",
        "ğŸ¥°",
        "ğŸ˜—",
        "ğŸ˜™",
        "ğŸ˜š",
        "â˜ºï¸",
        "ğŸ™‚",
        "ğŸ¤—",
        "ğŸ¤©",
        "ğŸ¤”",
        "ğŸ¤¨",
        "ğŸ˜",
        "ğŸ˜‘",
        "ğŸ˜¶",
        "ğŸ™„",
        "ğŸ˜",
        "ğŸ˜£",
        "ğŸ˜¥",
        "ğŸ˜®",
        "ğŸ¤",
        "ğŸ˜¯",
        "ğŸ˜ª",
        "ğŸ˜«",
        "ğŸ˜´",
        "ğŸ˜Œ",
        "ğŸ˜›",
        "ğŸ˜œ",
        "ğŸ˜",
        "ğŸ¤¤",
        "ğŸ˜’",
        "ğŸ˜“",
        "ğŸ˜”",
        "ğŸ˜•",
        "ğŸ™ƒ",
        "ğŸ¤‘",
        "ğŸ˜²",
        "â˜¹ï¸",
        "ğŸ™",
        "ğŸ˜–",
        "ğŸ˜",
        "ğŸ˜Ÿ",
        "ğŸ˜¤",
        "ğŸ˜¢",
        "ğŸ˜­",
        "ğŸ˜¦",
        "ğŸ˜§",
        "ğŸ˜¨",
        "ğŸ˜©",
        "ğŸ¤¯",
        "ğŸ˜¬",
        "ğŸ˜°",
        "ğŸ˜±",
        "ğŸ¥µ",
        "ğŸ¥¶",
        "ğŸ˜³",
        "ğŸ¤ª",
        "ğŸ˜µ",
        "ğŸ˜¡",
        "ğŸ˜ ",
        "ğŸ¤¬",
        "ğŸ˜·",
        "ğŸ¤’",
        "ğŸ¤•",
        "ğŸ¤¢",
        "ğŸ¤®",
        "ğŸ¤§",
        "ğŸ˜‡",
        "ğŸ¤ ",
        "ğŸ¤¡",
        "ğŸ¥³",
        "ğŸ¥´",
        "ğŸ¥º",
        "ğŸ¤¥",
        "ğŸ¤«",
        "ğŸ¤­",
        "ğŸ§",
        "ğŸ¤“",
        "ğŸ˜ˆ",
        "ğŸ‘¿",
        "ğŸ‘¹",
        "ğŸ‘º",
        "ğŸ’€",
        "ğŸ‘»",
        "ğŸ‘½",
        "ğŸ¤–",
        "ğŸ’©",
        "ğŸ˜º",
        "ğŸ˜¸",
        "ğŸ˜¹",
        "ğŸ˜»",
        "ğŸ˜¼",
        "ğŸ˜½",
        "ğŸ™€",
        "ğŸ˜¿",
        "ğŸ˜¾",
        "ğŸ¶",
        "ğŸ±",
        "ğŸ­",
        "ğŸ¹",
        "ğŸ°",
        "ğŸ¦Š",
        "ğŸ¦",
        "ğŸ»",
        "ğŸ¼",
        "ğŸ¦˜",
        "ğŸ¦¡",
        "ğŸ¨",
        "ğŸ¯",
        "ğŸ¦",
        "ğŸ®",
        "ğŸ·",
        "ğŸ½",
        "ğŸ¸",
        "ğŸµ",
        "ğŸ™ˆ",
        "ğŸ™‰",
        "ğŸ™Š",
        "ğŸ’",
        "ğŸ”",
        "ğŸ§",
        "ğŸ¦",
        "ğŸ¤",
        "ğŸ£",
        "ğŸ¥",
        "ğŸ¦†",
        "ğŸ¦¢",
        "ğŸ¦…",
        "ğŸ¦‰",
        "ğŸ¦š",
        "ğŸ¦œ",
        "ğŸ¦‡",
        "ğŸº",
        "ğŸ—",
        "ğŸ´",
        "ğŸ¦„",
        "ğŸ",
        "ğŸ›",
        "ğŸ¦‹",
        "ğŸŒ",
        "ğŸš",
        "ğŸ",
        "ğŸœ",
        "ğŸ¦—",
        "ğŸ•·",
        "ğŸ•¸",
        "ğŸ¦‚",
        "ğŸ¦Ÿ",
        "ğŸ¦ ",
        "ğŸ¢",
        "ğŸ",
        "ğŸ¦",
        "ğŸ¦–",
        "ğŸ¦•",
        "ğŸ™",
        "ğŸ¦‘",
        "ğŸ¦",
        "ğŸ¦€",
        "ğŸ¡",
        "ğŸ ",
        "ğŸŸ",
        "ğŸ¬",
        "ğŸ³",
        "ğŸ‹",
        "ğŸ¦ˆ",
        "ğŸŠ",
        "ğŸ…",
        "ğŸ†",
        "ğŸ¦“",
        "ğŸ¦",
        "ğŸ˜",
        "ğŸ¦",
        "ğŸ¦›",
        "ğŸª",
        "ğŸ«",
        "ğŸ¦™",
        "ğŸ¦’",
        "ğŸƒ",
        "ğŸ‚",
        "ğŸ„",
        "ğŸ",
        "ğŸ–",
        "ğŸ",
        "ğŸ‘",
        "ğŸ",
        "ğŸ¦Œ",
        "ğŸ•",
        "ğŸ©",
        "ğŸˆ",
        "ğŸ“",
        "ğŸ¦ƒ",
        "ğŸ•Š",
        "ğŸ‡",
        "ğŸ",
        "ğŸ€",
        "ğŸ¿",
        "ğŸ¦”",
        "ğŸ¾",
        "ğŸ‰",
        "ğŸ²",
        "ğŸŒµ",
        "ğŸ„",
        "ğŸŒ²",
        "ğŸŒ³",
        "ğŸŒ´",
        "ğŸŒ±",
        "ğŸŒ¿",
        "â˜˜ï¸",
        "ğŸ€",
        "ğŸ",
        "ğŸ‹",
        "ğŸƒ",
        "ğŸ‚",
        "ğŸ",
        "ğŸ„",
        "ğŸŒ¾",
        "ğŸ’",
        "ğŸŒ·",
        "ğŸŒ¹",
        "ğŸ¥€",
        "ğŸŒº",
        "ğŸŒ¸",
        "ğŸŒ¼",
        "ğŸŒ»",
        "ğŸŒ",
        "ğŸŒ",
        "ğŸŒ›",
        "ğŸŒœ",
        "ğŸŒš",
        "ğŸŒ•",
        "ğŸŒ–",
        "ğŸŒ—",
        "ğŸŒ˜",
        "ğŸŒ‘",
        "ğŸŒ’",
        "ğŸŒ“",
        "ğŸŒ”",
        "ğŸŒ™",
        "ğŸŒ",
        "ğŸŒ",
        "ğŸŒ",
        "ğŸ’«",
        "â­ï¸",
        "ğŸŒŸ",
        "âœ¨",
        "âš¡ï¸",
        "â˜„ï¸",
        "ğŸ’¥",
        "ğŸ”¥",
        "ğŸŒª",
        "ğŸŒˆ",
        "â˜€ï¸",
        "ğŸŒ¤",
        "â›…ï¸",
        "ğŸŒ¥",
        "â˜ï¸",
        "ğŸŒ¦",
        "ğŸŒ§",
        "â›ˆ",
        "ğŸŒ©",
        "ğŸŒ¨",
        "â„ï¸",
        "â˜ƒï¸",
        "â›„ï¸",
        "ğŸŒ¬",
        "ğŸ’¨",
        "ğŸ’§",
        "ğŸ’¦",
        "â˜”ï¸",
        "â˜‚ï¸",
        "ğŸŒŠ",
        "ğŸŒ«",
        "ğŸ",
        "ğŸ",
        "ğŸ",
        "ğŸŠ",
        "ğŸ‹",
        "ğŸŒ",
        "ğŸ‰",
        "ğŸ‡",
        "ğŸ“",
        "ğŸˆ",
        "ğŸ’",
        "ğŸ‘",
        "ğŸ",
        "ğŸ¥­",
        "ğŸ¥¥",
        "ğŸ¥",
        "ğŸ…",
        "ğŸ†",
        "ğŸ¥‘",
        "ğŸ¥¦",
        "ğŸ¥’",
        "ğŸ¥¬",
        "ğŸŒ¶",
        "ğŸŒ½",
        "ğŸ¥•",
        "ğŸ¥”",
        "ğŸ ",
        "ğŸ¥",
        "ğŸ",
        "ğŸ¥–",
        "ğŸ¥¨",
        "ğŸ¥¯",
        "ğŸ§€",
        "ğŸ¥š",
        "ğŸ³",
        "ğŸ¥",
        "ğŸ¥“",
        "ğŸ¥©",
        "ğŸ—",
        "ğŸ–",
        "ğŸŒ­",
        "ğŸ”",
        "ğŸŸ",
        "ğŸ•",
        "ğŸ¥ª",
        "ğŸ¥™",
        "ğŸŒ®",
        "ğŸŒ¯",
        "ğŸ¥—",
        "ğŸ¥˜",
        "ğŸ¥«",
        "ğŸ",
        "ğŸœ",
        "ğŸ²",
        "ğŸ›",
        "ğŸ£",
        "ğŸ±",
        "ğŸ¥Ÿ",
        "ğŸ¤",
        "ğŸ™",
        "ğŸš",
        "ğŸ˜",
        "ğŸ¥",
        "ğŸ¥®",
        "ğŸ¥ ",
        "ğŸ¢",
        "ğŸ¡",
        "ğŸ§",
        "ğŸ¨",
        "ğŸ¦",
        "ğŸ¥§",
        "ğŸ°",
        "ğŸ‚",
        "ğŸ®",
        "ğŸ­",
        "ğŸ¬",
        "ğŸ«",
        "ğŸ¿",
        "ğŸ§‚",
        "ğŸ©",
        "ğŸª",
        "ğŸŒ°",
        "ğŸ¥œ",
        "ğŸ¯",
        "ğŸ¥›",
        "ğŸ¼",
        "â˜•ï¸",
        "ğŸµ",
        "ğŸ¥¤",
        "ğŸ¶",
        "ğŸº",
        "ğŸ»",
        "ğŸ¥‚",
        "ğŸ·",
        "ğŸ¥ƒ",
        "ğŸ¸",
        "ğŸ¹",
        "ğŸ¾",
        "ğŸ¥„",
        "ğŸ´",
        "ğŸ½",
        "ğŸ¥£",
        "ğŸ¥¡",
        "ğŸ¥¢",
        "ğŸš—",
        "ğŸš•",
        "ğŸš™",
        "ğŸšŒ",
        "ğŸš",
        "ğŸ",
        "ğŸš“",
        "ğŸš‘",
        "ğŸš’",
        "ğŸš",
        "ğŸšš",
        "ğŸš›",
        "ğŸšœ",
        "ğŸ›´",
        "ğŸš²",
        "ğŸ›µ",
        "ğŸ",
        "ğŸš¨",
        "ğŸš”",
        "ğŸš",
        "ğŸš˜",
        "ğŸš–",
        "ğŸš¡",
        "ğŸš ",
        "ğŸšŸ",
        "ğŸšƒ",
        "ğŸš‹",
        "ğŸš",
        "ğŸš",
        "ğŸš„",
        "ğŸš…",
        "ğŸšˆ",
        "ğŸš‚",
        "ğŸš†",
        "ğŸš‡",
        "ğŸšŠ",
        "ğŸš‰",
        "âœˆï¸",
        "ğŸ›«",
        "ğŸ›¬",
        "ğŸ›©",
        "ğŸ’º",
        "ğŸ›°",
        "ğŸš€",
        "ğŸ›¸",
        "ğŸš",
        "ğŸ›¶",
        "â›µï¸",
        "ğŸš¤",
        "ğŸ›¥",
        "ğŸ›³",
        "â›´",
        "ğŸš¢",
        "âš“ï¸",
        "â›½ï¸",
        "ğŸš§",
        "ğŸš¦",
        "ğŸš¥",
        "ğŸš",
        "ğŸ—º",
        "ğŸ—¿",
        "ğŸ—½",
        "ğŸ—¼",
        "ğŸ°",
        "ğŸ¯",
        "ğŸŸ",
        "ğŸ¡",
        "ğŸ¢",
        "ğŸ ",
        "â›²ï¸",
        "â›±",
        "ğŸ–",
        "ğŸ",
        "ğŸœ",
        "ğŸŒ‹",
        "â›°",
        "ğŸ”",
        "ğŸ—»",
        "ğŸ•",
        "â›ºï¸",
        "ğŸ ",
        "ğŸ¡",
        "ğŸ˜",
        "ğŸš",
        "ğŸ—",
        "ğŸ­",
        "ğŸ¢",
        "ğŸ¬",
        "ğŸ£",
        "ğŸ¤",
        "ğŸ¥",
        "ğŸ¦",
        "ğŸ¨",
        "ğŸª",
        "ğŸ«",
        "ğŸ©",
        "ğŸ’’",
        "ğŸ›",
        "â›ªï¸",
        "ğŸ•Œ",
        "ğŸ•",
        "ğŸ•‹",
        "â›©",
        "ğŸ›¤",
        "ğŸ›£",
        "ğŸ—¾",
        "ğŸ‘",
        "ğŸ",
        "ğŸŒ…",
        "ğŸŒ„",
        "ğŸŒ ",
        "ğŸ‡",
        "ğŸ†",
        "ğŸŒ‡",
        "ğŸŒ†",
        "ğŸ™",
        "ğŸŒƒ",
        "ğŸŒŒ",
        "ğŸŒ‰",
        "ğŸŒ",
        "âŒšï¸",
        "ğŸ“±",
        "ğŸ“²",
        "ğŸ’»",
        "âŒ¨ï¸",
        "ğŸ–¥",
        "ğŸ–¨",
        "ğŸ–±",
        "ğŸ–²",
        "ğŸ•¹",
        "ğŸ—œ",
        "ğŸ’½",
        "ğŸ’¾",
        "ğŸ’¿",
        "ğŸ“€",
        "ğŸ“¼",
        "ğŸ“·",
        "ğŸ“¸",
        "ğŸ“¹",
        "ğŸ¥",
        "ğŸ“½",
        "ğŸ",
        "ğŸ“",
        "â˜ï¸",
        "ğŸ“Ÿ",
        "ğŸ“ ",
        "ğŸ“º",
        "ğŸ“»",
        "ğŸ™",
        "ğŸš",
        "ğŸ›",
        "â±",
        "â²",
        "â°",
        "ğŸ•°",
        "âŒ›ï¸",
        "â³",
        "ğŸ“¡",
        "ğŸ”‹",
        "ğŸ”Œ",
        "ğŸ’¡",
        "ğŸ”¦",
        "ğŸ•¯",
        "ğŸ—‘",
        "ğŸ›¢",
        "ğŸ’¸",
        "ğŸ’µ",
        "ğŸ’´",
        "ğŸ’¶",
        "ğŸ’·",
        "ğŸ’°",
        "ğŸ’³",
        "ğŸ§¾",
        "ğŸ’",
        "âš–ï¸",
        "ğŸ”§",
        "ğŸ”¨",
        "âš’",
        "ğŸ› ",
        "â›",
        "ğŸ”©",
        "âš™ï¸",
        "â›“",
        "ğŸ”«",
        "ğŸ’£",
        "ğŸ”ª",
        "ğŸ—¡",
        "âš”ï¸",
        "ğŸ›¡",
        "ğŸš¬",
        "âš°ï¸",
        "âš±ï¸",
        "ğŸº",
        "ğŸ§­",
        "ğŸ§±",
        "ğŸ”®",
        "ğŸ§¿",
        "ğŸ§¸",
        "ğŸ“¿",
        "ğŸ’ˆ",
        "âš—ï¸",
        "ğŸ”­",
        "ğŸ§°",
        "ğŸ§²",
        "ğŸ§ª",
        "ğŸ§«",
        "ğŸ§¬",
        "ğŸ§¯",
        "ğŸ”¬",
        "ğŸ•³",
        "ğŸ’Š",
        "ğŸ’‰",
        "ğŸŒ¡",
        "ğŸš½",
        "ğŸš°",
        "ğŸš¿",
        "ğŸ›",
        "ğŸ›€",
        "ğŸ›€ğŸ»",
        "ğŸ›€ğŸ¼",
        "ğŸ›€ğŸ½",
        "ğŸ›€ğŸ¾",
        "ğŸ›€ğŸ¿",
        "ğŸ§´",
        "ğŸ§µ",
        "ğŸ§¶",
        "ğŸ§·",
        "ğŸ§¹",
        "ğŸ§º",
        "ğŸ§»",
        "ğŸ§¼",
        "ğŸ§½",
        "ğŸ›",
        "ğŸ”‘",
        "ğŸ—",
        "ğŸšª",
        "ğŸ›‹",
        "ğŸ›",
        "ğŸ›Œ",
        "ğŸ–¼",
        "ğŸ›",
        "ğŸ§³",
        "ğŸ›’",
        "ğŸ",
        "ğŸˆ",
        "ğŸ",
        "ğŸ€",
        "ğŸŠ",
        "ğŸ‰",
        "ğŸ§¨",
        "ğŸ",
        "ğŸ®",
        "ğŸ",
        "ğŸ§§",
        "âœ‰ï¸",
        "ğŸ“©",
        "ğŸ“¨",
        "ğŸ“§",
        "ğŸ’Œ",
        "ğŸ“¥",
        "ğŸ“¤",
        "ğŸ“¦",
        "ğŸ·",
        "ğŸ“ª",
        "ğŸ“«",
        "ğŸ“¬",
        "ğŸ“­",
        "ğŸ“®",
        "ğŸ“¯",
        "ğŸ“œ",
        "ğŸ“ƒ",
        "ğŸ“„",
        "ğŸ“‘",
        "ğŸ“Š",
        "ğŸ“ˆ",
        "ğŸ“‰",
        "ğŸ—’",
        "ğŸ—“",
        "ğŸ“†",
        "ğŸ“…",
        "ğŸ“‡",
        "ğŸ—ƒ",
        "ğŸ—³",
        "ğŸ—„",
        "ğŸ“‹",
        "ğŸ“",
        "ğŸ“‚",
        "ğŸ—‚",
        "ğŸ—",
        "ğŸ“°",
        "ğŸ““",
        "ğŸ“”",
        "ğŸ“’",
        "ğŸ“•",
        "ğŸ“—",
        "ğŸ“˜",
        "ğŸ“™",
        "ğŸ“š",
        "ğŸ“–",
        "ğŸ”–",
        "ğŸ”—",
        "ğŸ“",
        "ğŸ–‡",
        "ğŸ“",
        "ğŸ“",
        "ğŸ“Œ",
        "ğŸ“",
        "âœ‚ï¸",
        "ğŸ–Š",
        "ğŸ–‹",
        "âœ’ï¸",
        "ğŸ–Œ",
        "ğŸ–",
        "ğŸ“",
        "âœï¸",
        "ğŸ”",
        "ğŸ”",
        "ğŸ”",
        "ğŸ”",
        "ğŸ”’",
        "ğŸ”“",
    ]

adjective = random.choice(adjectives).title()
animal = random.choice(animals).title()

if args.emojis:
    # 3 random emojis
    rand = "".join(+[random.choice(emojis) for _ in range(3)])
else:
    # Provide 6 alphanumerical characters randomly (example: VYe11Y)
    rand = "".join(
        random.choice(string.ascii_letters + string.digits) for _ in range(6)
    )

# Get date path (format: YYYY/MM/DD)
curdate = now.strftime("%Y/%m/%d")

outPath = f"Flameshot/{curdate}/{'ğŸ’£_' if args.timebomb else ''}{adjective}{animal}_{rand}{os.path.splitext(args.image)[1]}"
outUrl = f"https://cdn.botato.gq/{outPath}"

additionalArgs = ""

if args.timebomb:
    expires = now + timedelta(days=1)
    timestampInMs = int(expires.timestamp() * 1000)


bucket.upload_local_file(
    local_file=args.image,
    file_name=outPath,
    file_retention=b2.FileRetentionSetting(
        mode="governance", retain_until=timestampInMs
    )
    if args.timebomb
    else None,
)

if not args.no_copy:
    pyperclip.copy(outUrl)

print(outUrl)
